<div class="panel">
    <h3>Rechercher</h3>
    <http-search url="{{ctrl.searchUrl}}" ng-model="ctrl.searchString"></http-search>
    <button class="btn btn-success pull-right" ng-click="ctrl.search()">Afficher</button>
</div>
<button type="button" ng-if="ctrl.user_is_admin" class="btn btn-success" ng-click="ctrl.create_new()">Nouveau</button>
<hr />
<div ng-class="{'col-lg-6': ctrl.searchResults.length, 'col-lg-12': !ctrl.searchResults.length}" ng-if="ctrl.editing" ng-include="'/outils/js/templates/annuaire/form.htm'">
</div>

<div class="col-lg-6" ng-if="ctrl.showing" ng-include="'/outils/js/templates/annuaire/show.htm'">
</div>
<div ng-class="{'col-lg-12': !(ctrl.editing || ctrl.showing), 'col-lg-6': (ctrl.editing || ctrl.showing)}" ng-if="ctrl.searchResults['correspondant'].length||ctrl.searchResults['commune'].length||ctrl.searchResults['entite'].length">
    <div class="panel panel-primary"> 
        <div class="panel-heading">
            <div class="panel-title">Resultats de la recherche</div>
        </div>
        <div class="panel-content">
            <ul class="list-inline">
                <li>Résultats affichés : </li>
                <li><input id="type1" type="checkbox" ng-model="ctrl.types_shown.correspondant"><label for="type1">Correspondants</label></li>
                <li><input id="type2" type="checkbox" ng-model="ctrl.types_shown.entite"><label for="type2">Groupes</label></li>
                <li><input id="type3" type="checkbox" ng-model="ctrl.types_shown.commune"><label for="type3">Communes</label></li>
            </ul>
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>N° de téléphone</th>
                        <th>Adresse email</th>
                    </tr>
                </thead>
                <tbody ng-if="ctrl.types_shown['correspondant']">
                    <tr ng-if="ctrl.searchResults['correspondant'].length">
                        <th colspan="2">Correspondants
                        </th>
                        <td>
                            <small><a ng-href="mailto:{{ctrl.mail_all('correspondant')}}">Ecrire à tous</a></small>
                        </td>
                    </tr>
                    <tr ng-repeat="item in ctrl.searchResults['correspondant']" ng-click="ctrl.show(item)" style="cursor: pointer;">
                        <td>{{item.label}}</td>
                        <td>{{item.telephone|formatTel}}</td>
                        <td><a ng-href="mailto:{{item.email}}" ng-click="ctrl.cancel_event($event)">{{item.email}}</a></td>
                    </tr>
                </tbody>
                <tbody ng-if="ctrl.types_shown['commune']">
                    <tr ng-if="ctrl.searchResults['commune'].length">
                        <th colspan="3">Communes</th>
                    </tr>
                    <tr ng-repeat="item in ctrl.searchResults['commune']" ng-click="ctrl.show(item)" style="cursor: pointer;">
                        <td>{{item.label}}</td>
                        <td>{{item.telephone|formatTel}}</td>
                        <td><a ng-href="mailto:{{item.email}}" ng-click="ctrl.cancel_event($event)">{{item.email}}</a></td>
                    </tr>
                </tbody>
                <tbody ng-if="ctrl.types_shown['entite']">
                    <tr ng-if="ctrl.searchResults['entite'].length">
                        <th colspan="3">Groupes</th>
                    </tr>
                    <tr ng-repeat="item in ctrl.searchResults['entite']" ng-click="ctrl.show(item)" style="cursor: pointer;">
                        <td colspan="3">{{item.label}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<div ng-if="!ctrl.searchResults['correspondant'].length&&!ctrl.searchResults['commune'].length&&!ctrl.searchResults['entite'].length">
    <h3>Aucune recherche ou aucun résultat à afficher</h3>
<div>
