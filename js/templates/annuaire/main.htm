<div class="panel">
    <h3>Rechercher<small class="pull-right"><a href="http://192.168.10.10:5000/pnc/documentation_generale/wikis/annuaire_tizoutis" target="_blank">Aide</a></small></h3>
    <http-search url="{{ctrl.searchUrl}}" ng-model="ctrl.searchString"></http-search>
    <button class="btn btn-success pull-right" ng-click="ctrl.search()">Afficher</button>
</div>
<button type="button" ng-if="ctrl.user_is_admin" class="btn btn-success" ng-click="ctrl.create_new()">Nouveau</button>
<br />
<div ng-class="{'col-lg-6': ctrl.searchResults.length, 'col-lg-12': !ctrl.searchResults.length}" ng-if="ctrl.editing" ng-include="'static/js/templates/annuaire/form.htm'">
</div>

<div class="col-lg-6" ng-if="ctrl.showing" ng-include="'static/js/templates/annuaire/show.htm'">
</div>
<div ng-class="{'col-lg-12': !(ctrl.editing || ctrl.showing), 'col-lg-6': (ctrl.editing || ctrl.showing)}" ng-if="ctrl.searchResults['correspondant'].length||ctrl.searchResults['commune'].length||ctrl.searchResults['entite'].length">
    <div class="panel panel-primary"> 
        <div class="panel-heading">
            <div class="panel-title">Resultats de la recherche</div>
        </div>
        <div class="panel-content">
            <ul class="list-inline">
                <li>Résultats affichés : </li>
                <li><input id="type1" type="checkbox" ng-model="ctrl.types_shown.correspondant"><label for="type1">Correspondants <small class="text-info">({{ctrl.searchResults['correspondant'].length}})</small></label></li>
                <li><input id="type2" type="checkbox" ng-model="ctrl.types_shown.entite"><label for="type2">Groupes <small class="text-info">({{ctrl.searchResults['entite'].length}})</small></label></li>
                <li><input id="type3" type="checkbox" ng-model="ctrl.types_shown.commune"><label for="type3">Communes <small class="text-info">({{ctrl.searchResults['commune'].length}})</small></label></li>
            </ul>
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>N° de téléphone</th>
                        <th colspan="2">Adresse email</th>
                    </tr>
                </thead>
                <tbody ng-if="ctrl.types_shown['correspondant']">
                    <tr ng-if="ctrl.searchResults['correspondant'].length">
                        <th colspan="2">Correspondants <small class="text-info">({{ctrl.searchResults['correspondant'].length}} résultats)</small>
                        </th>
                        <td colspan="2">
                            <a class="btn btn-xs btn-primary" ng-href="mailto:{{ctrl.mail_all('correspondant')}}">Ecrire à tous</a>  
                            <a class="btn btn-xs btn-info" ng-href="{{princ_ctrl.get_url('/annuaire/entites?format=vcard&params=')}}{{ctrl.url_params.s.join('&params=') || ctrl.url_params.s}}" target="_blank">VCARD</a> 
                            <a class="btn btn-xs btn-success" ng-href="{{princ_ctrl.get_url('/annuaire/entites?format=csv&params=')}}{{ctrl.url_params.s.join('&params=') || ctrl.url_params.s}}" target="_blank">CSV</a> 
                            <a class="btn btn-xs btn-warning" ng-href="{{princ_ctrl.get_url('/annuaire/entites?format=tsv&params=')}}{{ctrl.url_params.s.join('&params=') || ctrl.url_params.s}}" target="_blank">CSV (Excel)</a>
                        </td>
                    </tr>
                    <tr ng-repeat="item in ctrl.searchResults['correspondant']" ng-click="ctrl.show(item)" style="cursor: pointer;">
                        <td>{{item.label}}</td>
                        <td>{{item.telephone|formatTel}}</td>
                        <td><a ng-href="mailto:{{item.email}}" ng-click="ctrl.cancel_event($event)">{{item.email}}</a></td>
                        <td><a class="btn btn-xs btn-info" ng-href="{{princ_ctrl.get_url('/annuaire/entite/')}}{{item.id}}?format=vcard" target="_blank">VCARD</a></td>
                    </tr>
                </tbody>
                <tbody ng-if="ctrl.types_shown['commune']">
                    <tr ng-if="ctrl.searchResults['commune'].length">
                        <th colspan="4">Communes <small class="text-info">({{ctrl.searchResults['commune'].length}} résultats)</small>
                        </th>
                    </tr>
                    <tr ng-repeat="item in ctrl.searchResults['commune']" ng-click="ctrl.show(item)" style="cursor: pointer;">
                        <td>{{item.label}}</td>
                        <td>{{item.telephone|formatTel}}</td>
                        <td colspan="2"><a ng-href="mailto:{{item.email}}" ng-click="ctrl.cancel_event($event)">{{item.email}}</a></td>
                    </tr>
                </tbody>
                <tbody ng-if="ctrl.types_shown['entite']">
                    <tr ng-if="ctrl.searchResults['entite'].length">
                        <th colspan="4">Groupes</th>
                    </tr>
                    <tr ng-repeat="item in ctrl.searchResults['entite']" ng-click="ctrl.show(item)" style="cursor: pointer;">
                        <td colspan="4">{{item.label}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="container" ng-if="!ctrl.searchResults['correspondant'].length&&!ctrl.searchResults['commune'].length&&!ctrl.searchResults['entite'].length">
    <h3>Aucune recherche ou aucun résultat à afficher</h3><hr />
    <h4>Comment rechercher ?</h4>
    <p>Tapez votre recherche dans la barre du dessus et veillez bien à sélectionner un élément parmis ceux qui vous sont proposés. S'il n'y a aucune proposition en fonction de votre frappe, vous n'obtiendrez aucun résultat.</p>
    <p>Vous pouvez rechercher directement sur le nom d'une personne ou d'une commune, ou rechercher par groupes. Par exemple une recherche sur PNC affichera tous les agents du Parc.</p>
    <p>La liste de résultats affiche un résumé des informations diponibles pour chaque correspondant ou commune. Il suffit de cliquer sur un des résultats pour afficher des informations plus détaillées.</p>
    <hr />
    <h4>Affiner sa recherche</h4>
    <p>Il est possible de saisir plusieurs critères de recherche en cliquant sur le bouton <span class="btn btn-xs btn-default glyphicon glyphicon-plus"></span> situé à droite de la barre de recherche. Les résultats affichés seront alors ceux qui correspondent à tous les critères de recherche saisis.<p>
    <p>Exemple : Une recherche sur PNC + SCVT + Aigoual n'affichera que les agents du SCVT du massif Aigoual.</p>
    <p>Afficher plus de barres de recherche que nécessaire ne pose aucun problème, il est cependant possible de supprimer les barres inutiles (ou des saisies fausses) en cliquant sur le bouton <span class="btn btn-xs btn-default glyphicon glyphicon-minus"></span> situé à droite des barres de recherche.</p>
    <hr />
    <h4>Boutons utiles</h4>
    <p>Plusieurs boutons sont affichés en tête de la colonne "Adresse email" :</p>
    <ul class="list">
        <li><span class="btn btn-primary btn-xs">Ecrire à tous</span> Permet de créer un nouveau message (en utilisant un client mail compatible comme thunderbird par exemple) avec pour destinataires tous les correspondants affichés.</li>
        <li><span class="btn btn-info btn-xs">VCARD</span> Permet de télécharger la liste des correspondants affichés au format VCARD, pour ensuite l'importer dans votre client mail comme carnet d'adressse, ou dans votre téléphone mobile.</li>
        <li><span class="btn btn-success btn-xs">CSV</span> Permet de télécharger la liste des correspondants au format CSV, utilisable dans LibreOffice ou les versions récentes de MS Office pour générer des listes de publipostage.</li>
        <li><span class="btn btn-warning btn-xs">CSV (Excel)</span> Permet de télécharger la liste dans une variante du format CSV, utilisable dans les anciennes versions de MS Office.</li>
    </ul>
    <p>L'adresse email de chaque correspondant est cliquable et permet de créer un nouveau message avec le correspondant pour destinataire.</p>
    <p>Le bouton <span class="btn btn-info btn-xs">VCARD</span> situé à droite de l'adresse email de chaque correspondant permet de télécharger la VCARD de cet unique correspondant</p>
<div>
